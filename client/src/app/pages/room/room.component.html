<section class="room" [class.include-chat]="peerService.connected$ | async">

  <div class="chat-container" *ngIf="peerService.connected$ | async">
    <div class="room-id-panel">
      <span class="label">Room ID</span>
      <input type="text" nbInput value="{{ roomId }}" disabled>
    </div>

    <div class="chat">
      <ul class="messages-box">
        <li class="message"
            *ngFor="let chatMessage of (chatService.chatMessages$ | async)"
            [ngClass]="{ 'system': chatMessage.from === 'system', 'to': chatMessage.from === 'me', 'from': chatMessage.from !== 'me' }"
        >
            <span class="message-header" *ngIf="chatMessage.from === 'system'; else notSystemMessage">
              <i>{{ chatMessage.message }}</i>
              <br/>
              ({{ chatMessage.ts | date: 'HH:mm:ss' }})
            </span>

          <ng-template #notSystemMessage>
              <span class="message-header">
                [ {{ chatMessage.ts | date: 'HH:mm:ss' }} ] <i>{{ chatMessage.from !== 'me' ? (chatMessage.username + (chatMessage.type === MessageType.broadcast ? ' (Broadcast)' : ' (Direct)')) : 'You' }}:</i>
              </span>
            <span>{{ chatMessage.message }}</span>
          </ng-template>
        </li>
      </ul>
      <div class="typing-box">
        <input type="text" nbInput
               shape="semi-round"
               placeholder="Send message to supervisor"
               [(ngModel)]="chatMessage"
        >
        <button nbButton status="info"
                (click)="onSendChatMessage()"
                [disabled]="!(chatMessage?.length > 0)">
          <nb-icon icon="paper-plane-outline"></nb-icon>
        </button>
      </div>
    </div>
  </div>

  <div class="idle-state" *ngIf="(roomState$ | async) === RoomState.idle">
    <div class="form-group">
      <span class="label">Join a room</span>
      <input type="text" nbInput placeholder="Enter your name"
             [ngModel]="attendeeName"
             (ngModelChange)="onAttendeeNameType($event)">
    </div>

    <div class="form-group">
      <input type="text" nbInput placeholder="Room ID" [(ngModel)]="roomId">
    </div>
    <button nbButton status="info" (click)="onJoinRoom()">Join</button>
  </div>

  <div class="call-state" [class.hidden]="(roomState$ | async) !== RoomState.call">
<!--    <app-video-container-->
<!--      [stream]="mediaService.webcamStream"-->
<!--      [label]="attendeeName"-->
<!--    ></app-video-container>-->

<!--    <app-video-container-->
<!--      [stream]="mediaService.remoteWebcamStream"-->
<!--      label="{{ attendeeName }} (Stream)"-->
<!--    ></app-video-container>-->

<!--    <app-video-container-->
<!--      [stream]="mediaService.screenStream"-->
<!--      label="Screen"-->
<!--    ></app-video-container>-->

<!--    <app-video-container-->
<!--      [stream]="mediaService.remoteScreenStream"-->
<!--      label="Screen (Stream)"-->
<!--    ></app-video-container>-->

    <video autoplay muted [srcObject]="mediaService.webcamStream"></video>
    <video autoplay muted [srcObject]="mediaService.remoteWebcamStream"></video>
    <video autoplay muted [srcObject]="mediaService.screenStream"></video>
    <video autoplay muted [srcObject]="mediaService.remoteScreenStream"></video>
  </div>

  <div class="ended-call-state" *ngIf="(roomState$ | async) === RoomState.endedCall">
    <span>See you next time, {{ attendeeName }}! ğŸ‘‹</span>
  </div>
</section>

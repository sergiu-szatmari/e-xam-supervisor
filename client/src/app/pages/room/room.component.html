<section class="room" [class.include-chat]="(roomState$ | async) === RoomState.call">

  <div class="chat-container" *ngIf="(roomState$ | async) === RoomState.call">
    <div class="room-id-panel">
      <span class="label">Room ID</span>
      <input type="text" nbInput value="{{ roomId }}" disabled>
    </div>

    <div class="chat">
      <ul class="messages-box" #messagesBox>
        <li class="message"
            *ngFor="let chatMessage of chatMessages"
            [class.system]="chatMessage.from.peerId === 'system'"
            [class.to]="chatMessage.from.peerId === peerService.peerId"
            [class.from]="chatMessage.from.peerId !== peerService.peerId"
        >
            <span class="message-header" *ngIf="chatMessage.from.peerId === 'system'; else notSystemMessage">
              <i>{{ chatMessage.message }}</i>
              <br/>
              ({{ chatMessage.ts | date: 'HH:mm:ss' }})
            </span>

          <ng-template #notSystemMessage>
              <span class="message-header">
                [ {{ chatMessage.ts | date: 'HH:mm:ss' }} ] <i>{{
                  chatMessage.from.peerId !== peerService.peerId ?
                    (chatMessage.from.username +
                      (chatMessage.type === MessageType.broadcast ?
                        ' (Broadcast)' :
                        ' (Direct)'
                    )) :
                    'You'
                }}:</i>
              </span>
            <span>{{ chatMessage.message }}</span>
          </ng-template>
        </li>
      </ul>
      <div class="typing-box">
        <input type="text" nbInput
               shape="semi-round"
               placeholder="Send message to supervisor"
               [(ngModel)]="chatMessage"
               (keyup.enter)="onSendChatMessage()"
        >
        <button nbButton status="info"
                (click)="onSendChatMessage()"
                [disabled]="!(chatMessage?.length > 0)">
          <nb-icon icon="paper-plane-outline"></nb-icon>
        </button>
      </div>
    </div>
  </div>

  <div class="idle-state" *ngIf="(roomState$ | async) === RoomState.idle">
    <div class="form-group">
      <span class="label">Join a room</span>
      <input type="text" nbInput placeholder="Enter your name"
             [ngModel]="attendeeName"
             (ngModelChange)="onAttendeeNameType($event)">
    </div>

    <div class="form-group">
      <input type="text" nbInput placeholder="Room ID" [(ngModel)]="roomId">
    </div>
    <button nbButton status="info"
            [outline]="isLoadingBtn"
            [disabled]="isLoadingBtn"
            [nbSpinner]="isLoadingBtn"
            nbSpinnerStatus="info"
            (click)="onJoinRoom()"
    >{{ isLoadingBtn ? '' : 'Join' }}</button>
  </div>

  <div class="call-state" [class.hidden]="(roomState$ | async) !== RoomState.call">
    <video autoplay muted [srcObject]="mediaService.webcamStream"></video>
    <video autoplay muted [srcObject]="mediaService.screenStream"></video>
<!--    <video autoplay muted [srcObject]="mediaService.remoteWebcamStream"></video>-->
<!--    <video autoplay muted [srcObject]="mediaService.remoteScreenStream"></video>-->
  </div>

  <div class="ended-call-state" *ngIf="(roomState$ | async) === RoomState.endedCall">
    <span>See you next time, {{ attendeeName }}! ðŸ‘‹</span>
  </div>
</section>
